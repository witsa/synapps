<!-- start:source.tmpl.hbs -->
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width">
		<title>bindings/basic.js</title>
		<!--[if lt IE 9]>
		<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->
		<link href="https://fonts.googleapis.com/css?family=PT+Mono" rel="stylesheet">
		<link type="text/css" rel="stylesheet" href="css/bootstrap.min.css">
		<link type="text/css" rel="stylesheet" href="css/prism.min.css">
		<link type="text/css" rel="stylesheet" href="css/template.min.css">
		<script type="text/javascript">
			window.TEMPLATE_OPTIONS = {"includeDate":true,"dateFormat":"Do MMM YYYY","systemName":"Synapps Script API","systemSummary":"Documentation de l'API de script de la solution Synapps","systemLogo":"","systemColor":"","navMembers":[{"kind":"class","title":"Classes","summary":"All documented classes."},{"kind":"external","title":"Externals","summary":"All documented external members."},{"kind":"global","title":"Globals","summary":"All documented globals."},{"kind":"mixin","title":"Mixins","summary":"All documented mixins."},{"kind":"interface","title":"Interfaces","summary":"All documented interfaces."},{"kind":"module","title":"Modules","summary":"All documented modules."},{"kind":"namespace","title":"Namespaces","summary":"All documented namespaces."},{"kind":"tutorial","title":"Tutorials","summary":"All available tutorials."}],"footer":"","copyright":"","linenums":true,"collapseSymbols":false,"inverseNav":true,"inlineNav":false,"outputSourceFiles":false,"sourceRootPath":null,"disablePackagePath":true,"outputSourcePath":false,"showTableOfContents":true,"showAccessFilter":true,"analytics":null,"methodHeadingReturns":true,"sort":"linenum, longname, version, since","search":true,"favicon":null,"stylesheets":[],"scripts":[],"monospaceLinks":false,"cleverLinks":false,"default":{"outputSourceFiles":false}};
			window.DOCLET_TOC_ENABLED = false;
			window.DOCLET_AFILTER_ENABLED = false;
		</script>
</head>
<body>
	<!-- start:navbar.hbs -->
	<header class="navbar navbar-default navbar-fixed-top navbar-inverse">
		<div class="container">
			<div class="navbar-header">
				<a class="navbar-brand" href="index.html">
					Synapps Script API
				</a>
				<!-- displayed on small devices -->
				<button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#topNavigation">
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
			</div>
			<div class="navbar-collapse collapse" id="topNavigation">
				<ul class="nav navbar-nav">
								<li class="dropdown">
									<a href="global.html" class="dropdown-toggle" data-toggle="dropdown">Globals<b class="caret"></b></a>
									<ul class="dropdown-menu">
											<li><a href="global.html#_fixValue">_fixValue</a></li>
											<li><a href="global.html#changeStyleName">changeStyleName</a></li>
											<li><a href="global.html#data">data</a></li>
											<li><a href="global.html#isRequesting">isRequesting</a></li>
											<li><a href="global.html#removeBinding">removeBinding</a></li>
											<li><a href="global.html#request">request</a></li>
											<li><a href="global.html#requestDebounce">requestDebounce</a></li>
											<li><a href="global.html#write">write</a></li>
									</ul>
								</li>
								<li class="dropdown">
									<a href="list_class.html" class="dropdown-toggle" data-toggle="dropdown">Classes<b class="caret"></b></a>
									<ul class="dropdown-menu">
											<li><a href="Actor.BaseActor.html">Actor.BaseActor</a></li>
											<li><a href="Actor.Composite.html">Actor.Composite</a></li>
											<li><a href="Actor.DataSource.html">Actor.DataSource</a></li>
											<li><a href="Actor.Display.Html.html">Actor.Display.Html</a></li>
											<li><a href="Actor.Display.Iframe.html">Actor.Display.Iframe</a></li>
											<li><a href="Actor.Properties.BaseActorProperties.html">Actor.Properties.BaseActorProperties</a></li>
											<li><a href="Actor.Properties.Display.HtmlProperties.html">Actor.Properties.Display.HtmlProperties</a></li>
											<li><a href="Actor.Properties.Display.IframeProperties.html">Actor.Properties.Display.IframeProperties</a></li>
											<li><a href="Binding.BasicBinding.html">Binding.BasicBinding</a></li>
											<li><a href="Binding.InternalBinding.html">Binding.InternalBinding</a></li>
											<li><a href="Binding.Setup.Actor.html">Binding.Setup.Actor</a></li>
											<li><a href="Binding.Setup.Relative.html">Binding.Setup.Relative</a></li>
											<li><a href="Binding.Setup.Stage.html">Binding.Setup.Stage</a></li>
											<li><a href="Event.BaseContext.html">Event.BaseContext</a></li>
											<li><a href="Event.BaseContextUtils.html">Event.BaseContextUtils</a></li>
											<li><a href="Event.PropertyChangedContext.html">Event.PropertyChangedContext</a></li>
											<li><a href="PrototypedBase.html">PrototypedBase</a></li>
											<li><a href="Scene.html">Scene</a></li>
											<li><a href="WithProperties.html">WithProperties</a></li>
									</ul>
								</li>
								<li class="dropdown">
									<a href="list_interface.html" class="dropdown-toggle" data-toggle="dropdown">Interfaces<b class="caret"></b></a>
									<ul class="dropdown-menu">
											<li><a href="Stage.html">Stage</a></li>
									</ul>
								</li>
								<li class="dropdown">
									<a href="list_namespace.html" class="dropdown-toggle" data-toggle="dropdown">Namespaces<b class="caret"></b></a>
									<ul class="dropdown-menu">
											<li><a href="Actor.html">Actor</a></li>
											<li><a href="Actor.Display.html">Actor.Display</a></li>
											<li><a href="Actor.Properties.html">Actor.Properties</a></li>
											<li><a href="Actor.Properties.Display.html">Actor.Properties.Display</a></li>
											<li><a href="Binding.html">Binding</a></li>
											<li><a href="Event.html">Event</a></li>
											<li><a href="JSON.html">JSON</a></li>
									</ul>
								</li>
								<li class="dropdown">
									<a href="list_tutorial.html" class="dropdown-toggle" data-toggle="dropdown">Tutorials<b class="caret"></b></a>
									<ul class="dropdown-menu">
											<li><a href="tutorial-home.html">home</a></li>
											<li><a href="tutorial-other.html">other</a></li>
									</ul>
								</li>
				</ul>
					<!-- start:lunr-search-navbar.hbs -->
					<form class="navbar-form navbar-right" role="search">
						<div class="input-group">
							<input type="text" class="form-control" placeholder="Search" id="lunr-search-input">
							<div class="input-group-btn">
								<button class="btn btn-default" id="lunr-search-submit">
									<i class="glyphicon glyphicon-search"></i>
								</button>
							</div>
						</div>
					</form>
					<!-- start:lunr-search-navbar.hbs -->		</div>
		</div>
	</header>
	<!-- end:navbar.hbs -->		<div class="page-header">
			<div class="container">
				<span class="kind">source</span>
				<h1><span class="name">bindings/basic.js</span></h1>
			</div>
		</div>
	<div class="container content">
		<div class="row">
			<div class="col-md-12 main-content">
		<section class="source-section">
			<article></article>
			<pre class="prettyprint source language-javascript line-numbers"><code class="language-javascript">/* eslint-disable ember/no-observers */
import { assert } from '@ember/debug';
import { get, set } from '@ember/object';
import { addObserver, removeObserver } from '@ember/object/observers';
import { isEmpty } from '@ember/utils';
import DataContextual from 'synapps-ui/behaviors/data-contextual';
import Destroyable from 'synapps-ui/behaviors/destroyable';
import isValuesEqual from 'synapps-ui/tools/is-values-equal';

/**
 * Les liaisons.
 * @namespace Binding
 */

/**
 * Modes de lecture d'une liaison. &lt;br> Voir {@link Binding.BasicBinding}, {@link JSON.BasicBinding}
 * @typedef Binding.ReadModes
 * @readonly
 * @property always Synchronisé avec les changements de la valeur source.
 * @property onetime Une seule lecture, à l'initialisation de la liaison.
 */
const BindingReadModes = {
  always: 'always',
  onetime: 'onetime',
};

export { BindingReadModes };

@DataContextual('_target')
@Destroyable
class DataContextDestroyableObject extends Object {}

/**
 * @class
 * @memberof Binding
 * @extends Behavior.Destroyable
 */
class BasicBinding extends DataContextDestroyableObject {

  _canRead = true;
  _canWrite;
  _readMode;

  _target = null;

  _targetValuePath = '';

  _path = null;

  _isActive = false;


  _hasReadObserver = false;
  _hasWriteObserver = false;

  constructor({
    target,
    targetValuePath,
    dataContext = null,
    path = null,
    readMode = BindingReadModes.always,
    canWrite = false,
    onReadTransform,
    onWriteTransform,
  }) {
    super();

    assert('[BasicBinding][constructor] target is required to create a BasicBinding.', target);
    assert('[BasicBinding][constructor] targetValuePath is required to create a BasicBinding.', !isEmpty(targetValuePath));

    this._target = target;

    this._targetValuePath = targetValuePath;

    assert('[BasicBinding][constructor] readMode must have a valid option. ${readMode} is unknown.', Object.values(BindingReadModes).includes(readMode));
    this._readMode = readMode;

    if (onReadTransform) {
      this.onReadTransform = onReadTransform;
    }

    if (onWriteTransform) {
      this.onWriteTransform = onWriteTransform;
    }

    if (dataContext) {
      this.dataContext = dataContext;
    }

    if (path) {
      this._path = path;
    }

    this._canWrite = canWrite;
  }

  /**
   * La cible de la liaison.
   * @attribute
   * @readonly
   * @type {any}
   */
  get target() {
    return this._target;
  }

  /**
   * La chemin vers la valeur depuis la cible.
   * @attribute targetValuePath
   * @readonly
   * @type {string}
   */
  get targetValuePath() {
    return this._targetValuePath;
  }

  /**
   * La liaison est-elle active ?
   * @attribute
   * @readonly
   * @type {Boolean}
   */
  get isActive() {
    return this._isActive;
  }

  /**
   * la lecture est-elle permise ?
   * @attribute
   * @readonly
   * @type {Boolean}
   */
  get canRead() {
    return this._canRead;
  }

  /**
   * l'écriture est-elle permise ?
   * @attribute
   * @readonly
   * @type {Boolean}
   */
  get canWrite() {
    return this._canWrite;
  }

  /**
   * Le mode de lecture.
   - `always` pour chaque changement
   - `onetime` pour qu'une seule lecture.
   * @attribute
   * @type {Binding.ReadModes}

*/
  get readMode() {
    return this._readMode;
  }

  set readMode(value) {
    let toReactivate = false;
    if (this.isActive) {
      toReactivate = true;
      this.deactivate();
    }

    this._readMode = value;

    if (toReactivate) {
      this.activate();
    }
  }

  /**
   * Le chemin vers la valeur source.
   * @attribute path
   * @type {Boolean}
   */
  get path() {
    return this._path;
  }

  set path(newPath) {
    let toReactivate = false;
    if (this.isActive) {
      toReactivate = true;
      this.deactivate();
    }

    set(this, '_path', newPath);

    if (toReactivate) {
      this.activate();
    }
  }

  get _valuePath() {
    return this.path ? `dataContext.${this.path}` : 'dataContext';
  }

  _readValue() {
    return this.onReadTransform({ value: get(this, this._valuePath), binding: this });
  }

  _writeValue(newValue) {
    const transformedNewValue = this.onWriteTransform({ value: newValue, binding: this });
    if (isValuesEqual(transformedNewValue, get(this, this._valuePath), true)) return;
    set(this, this._valuePath, transformedNewValue);
  }

  _onDataContextValueChanged() {
    if (!this.dataContext) return;
    // logger.debug('_onDataContextValueChanged', this.target.uniqPath, this._targetValuePath, this._valuePath, this._readValue());
    set(this, `_target.${this._targetValuePath}`, this._readValue());
  }

  _onTargetValueChanged() {
    // logger.debug('_onTargetValueChanged', this.target.uniqPath, this._targetValuePath, this._valuePath, get(this, `_target.${this._targetValuePath}`));
    this._writeValue(get(this, `_target.${this._targetValuePath}`));
  }

  onReadTransform({ value /*, binding*/ }) {
    return value;
  }

  onWriteTransform({ value /*, binding*/ }) {
    return value;
  }

  /**
   * Active la liaison. La valeur de la source est observée. Si elle change, le champ cible est alimenté. Si l'écriture est permise, le champ cible est écouté également pour alimenté le champ source.
   */
  activate() {
    if (this.canRead) {
      if (this.readMode === BindingReadModes.always) {
        addObserver(this, this._valuePath, this._onDataContextValueChanged);
        this._hasReadObserver = true;
      }

      this._onDataContextValueChanged();
    }

    if (this.canWrite) {
      addObserver(this, `_target.${this._targetValuePath}`, this._onTargetValueChanged);
      this._hasWriteObserver = true;
    }

    set(this, '_isActive', true);
  }

  /**
   * Désactive la liaison. Il n'y aura plus d'observation de la valeur source.
   */
  deactivate() {
    if (!this.isActive) return;

    if (this._hasReadObserver) {
      removeObserver(this, this._valuePath, this._onDataContextValueChanged);
      this._hasReadObserver = false;
    }

    if (this._hasWriteObserver) {
      removeObserver(this, `_target.${this._targetValuePath}`, this._onTargetValueChanged);
      this._hasWriteObserver = false;
    }

    set(this, '_isActive', false);
  }

  willDestroy() {
    if (this.isDestroyed) return;
    this.deactivate();
    super.willDestroy();
    set(this, '_target', null);
  }
}

export default BasicBinding;

/**
 * @typedef JSON.BasicBinding
 * @property {string|null} [path=null] Chemin d'accès à la valeur source. La valeur `null` indique la valeur source est le contexte de donnée lui-même. &lt;br>Exemple:  `properties.width` ou `additionals.prop1`
 * @property {boolean} [canWrite=false] L'écriture est autorisée?
 * @property {*|null} [dataContext=null] Le contexte de donnée pris comme origine de la valeur source. Elle sera obtenue vial le chemin.
 * @property {Binding.ReadModes} [readMode=always] Mode de lecture de la valeur cible.
 */
</code></pre>
		</section>
			</div>
		</div>
	</div>
	<footer>
			<div class="generated-by">Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.6</a> on 3rd May 2021 using the <a href="https://github.com/steveush/foodoc">FooDoc template</a>.</div>
	</footer>
	<script src="js/jquery.min.js"></script>
	<script src="js/bootstrap.min.js"></script>
	<script src="js/clipboard.min.js"></script>
	<script src="js/prism.min.js"></script>
	<script src="js/template.min.js"></script>
		<!-- start:lunr-search-modal.hbs -->
		<div class="modal fade" id="lunr-search-modal">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title">Search results</h4>
					</div>
					<div class="modal-body" id="lunr-search-body">
					</div>
					<div class="modal-footer" id="lunr-search-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
					</div>
				</div><!-- /.modal-content -->
			</div><!-- /.modal-dialog -->
		</div>
		<!-- end:lunr-search-modal.hbs -->		<script src="js/lunr.min.js"></script>
	
</body>
</html>
<!-- end:source.tmpl.hbs -->