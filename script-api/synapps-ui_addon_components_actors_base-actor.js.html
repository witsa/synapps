<!-- start:source.tmpl.hbs -->
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width">
		<title>synapps-ui/addon/components/actors/base-actor.js</title>
		<!--[if lt IE 9]>
		<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->
		<link href="https://fonts.googleapis.com/css?family=PT+Mono" rel="stylesheet">
		<link type="text/css" rel="stylesheet" href="css/bootstrap.min.css">
		<link type="text/css" rel="stylesheet" href="css/prism.min.css">
		<link type="text/css" rel="stylesheet" href="css/template.min.css">
			<link type="text/css" rel="stylesheet" href="css/script-api-custom.css">
		<script type="text/javascript">
			window.TEMPLATE_OPTIONS = {"includeDate":true,"dateFormat":"Do MMM YYYY","systemName":"API des Scripts Synapps","systemSummary":"Documentation référence de l'API de script de la solution Synapps","systemLogo":"","systemColor":"","navMembers":[{"kind":"tutorial","title":"Guides","summary":"Tous les guides disponibles."},{"kind":"class","title":"Classes","summary":"Toutes les classes documentées."},{"kind":"external","title":"Externals","summary":"All documented external members."},{"kind":"global","title":"Globals","summary":"All documented globals."},{"kind":"mixin","title":"Mixins","summary":"All documented mixins."},{"kind":"interface","title":"Interfaces","summary":"All documented interfaces."},{"kind":"module","title":"Modules","summary":"All documented modules."},{"kind":"namespace","title":"Espaces de nom","summary":"Tous les espaces de nom documentés."}],"footer":"","copyright":"","linenums":true,"collapseSymbols":false,"inverseNav":true,"inlineNav":false,"outputSourceFiles":false,"sourceRootPath":null,"disablePackagePath":true,"outputSourcePath":false,"showTableOfContents":true,"showAccessFilter":true,"analytics":null,"methodHeadingReturns":true,"sort":"longname, linenum, version, since","search":true,"favicon":null,"stylesheets":["css/script-api-custom.css"],"scripts":[],"monospaceLinks":false,"cleverLinks":false,"default":{"outputSourceFiles":false}};
			window.DOCLET_TOC_ENABLED = false;
			window.DOCLET_AFILTER_ENABLED = false;
		</script>
</head>
<body>
	<!-- start:navbar.hbs -->
	<header class="navbar navbar-default navbar-fixed-top navbar-inverse">
		<div class="container">
			<div class="navbar-header">
				<a class="navbar-brand" href="index.html">
					API des Scripts Synapps
				</a>
				<!-- displayed on small devices -->
				<button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#topNavigation">
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
			</div>
			<div class="navbar-collapse collapse" id="topNavigation">
				<ul class="nav navbar-nav">
								<li class="dropdown">
									<a href="global.html" class="dropdown-toggle" data-toggle="dropdown">Globals<b class="caret"></b></a>
									<ul class="dropdown-menu">
											<li><a href="global.html#CssColorString">CssColorString</a></li>
											<li><a href="global.html#CssFontFamilyString">CssFontFamilyString</a></li>
											<li><a href="global.html#CssSizeString">CssSizeString</a></li>
											<li><a href="global.html#JSONString">JSONString</a></li>
									</ul>
								</li>
								<li class="dropdown">
									<a href="list_class.html" class="dropdown-toggle" data-toggle="dropdown">Classes<b class="caret"></b></a>
									<ul class="dropdown-menu">
											<li><a href="Accessory.BaseAccessory.html">Accessory.BaseAccessory</a></li>
											<li><a href="Actor.BaseActor.html">Actor.BaseActor</a></li>
											<li><a href="Actor.BaseActorProperties.html">Actor.BaseActorProperties</a></li>
											<li><a href="Actor.Charting.GaugeDemo.html">Actor.Charting.GaugeDemo</a></li>
											<li><a href="Actor.Charting.GaugeDemoProperties.html">Actor.Charting.GaugeDemoProperties</a></li>
											<li><a href="Actor.Composite.html">Actor.Composite</a></li>
											<li><a href="Actor.CompositeProperties.html">Actor.CompositeProperties</a></li>
											<li><a href="Actor.DataSource.html">Actor.DataSource</a></li>
											<li><a href="Actor.DataSourceProperties.html">Actor.DataSourceProperties</a></li>
											<li><a href="Actor.Display.CompositeView.html">Actor.Display.CompositeView</a></li>
											<li><a href="Actor.Display.CompositeViewProperties.html">Actor.Display.CompositeViewProperties</a></li>
											<li><a href="Actor.Display.Html.html">Actor.Display.Html</a></li>
											<li><a href="Actor.Display.HtmlProperties.html">Actor.Display.HtmlProperties</a></li>
											<li><a href="Actor.Display.Iframe.html">Actor.Display.Iframe</a></li>
											<li><a href="Actor.Display.IframeProperties.html">Actor.Display.IframeProperties</a></li>
											<li><a href="Actor.Display.Image.html">Actor.Display.Image</a></li>
											<li><a href="Actor.Display.ImageProperties.html">Actor.Display.ImageProperties</a></li>
											<li><a href="Actor.Display.Screen.html">Actor.Display.Screen</a></li>
											<li><a href="Actor.Display.ScreenProperties.html">Actor.Display.ScreenProperties</a></li>
											<li><a href="Actor.Display.Text.html">Actor.Display.Text</a></li>
											<li><a href="Actor.Display.TextProperties.html">Actor.Display.TextProperties</a></li>
											<li><a href="Actor.Input.BaseFilter.html">Actor.Input.BaseFilter</a></li>
											<li><a href="Actor.Input.BaseFilterProperties.html">Actor.Input.BaseFilterProperties</a></li>
											<li><a href="Actor.Input.BaseInput.html">Actor.Input.BaseInput</a></li>
											<li><a href="Actor.Input.BaseInputProperties.html">Actor.Input.BaseInputProperties</a></li>
											<li><a href="Actor.Input.Button.html">Actor.Input.Button</a></li>
											<li><a href="Actor.Input.ButtonList.html">Actor.Input.ButtonList</a></li>
											<li><a href="Actor.Input.ButtonListProperties.html">Actor.Input.ButtonListProperties</a></li>
											<li><a href="Actor.Input.ButtonProperties.html">Actor.Input.ButtonProperties</a></li>
											<li><a href="Actor.Input.Checkbox.html">Actor.Input.Checkbox</a></li>
											<li><a href="Actor.Input.CheckboxList.html">Actor.Input.CheckboxList</a></li>
											<li><a href="Actor.Input.CheckboxListProperties.html">Actor.Input.CheckboxListProperties</a></li>
											<li><a href="Actor.Input.CheckboxProperties.html">Actor.Input.CheckboxProperties</a></li>
											<li><a href="Actor.Input.Cursor.html">Actor.Input.Cursor</a></li>
											<li><a href="Actor.Input.CursorProperties.html">Actor.Input.CursorProperties</a></li>
											<li><a href="Actor.Input.DropdownList.html">Actor.Input.DropdownList</a></li>
											<li><a href="Actor.Input.DropdownListProperties.html">Actor.Input.DropdownListProperties</a></li>
											<li><a href="Actor.Input.NavButton.html">Actor.Input.NavButton</a></li>
											<li><a href="Actor.Input.NavButtonProperties.html">Actor.Input.NavButtonProperties</a></li>
											<li><a href="Actor.Input.Period.html">Actor.Input.Period</a></li>
											<li><a href="Actor.Input.PeriodProperties.html">Actor.Input.PeriodProperties</a></li>
											<li><a href="Actor.Input.RadioList.html">Actor.Input.RadioList</a></li>
											<li><a href="Actor.Input.RadioListProperties.html">Actor.Input.RadioListProperties</a></li>
											<li><a href="Actor.Input.SwitchButton.html">Actor.Input.SwitchButton</a></li>
											<li><a href="Actor.Input.SwitchButtonProperties.html">Actor.Input.SwitchButtonProperties</a></li>
											<li><a href="Actor.Input.SwitchImage.html">Actor.Input.SwitchImage</a></li>
											<li><a href="Actor.Input.SwitchImageProperties.html">Actor.Input.SwitchImageProperties</a></li>
											<li><a href="Actor.Input.TextArea.html">Actor.Input.TextArea</a></li>
											<li><a href="Actor.Input.TextAreaProperties.html">Actor.Input.TextAreaProperties</a></li>
											<li><a href="Actor.Input.TextBox.html">Actor.Input.TextBox</a></li>
											<li><a href="Actor.Input.TextBoxProperties.html">Actor.Input.TextBoxProperties</a></li>
											<li><a href="Actor.Layout.BaseLayout.html">Actor.Layout.BaseLayout</a></li>
											<li><a href="Actor.Layout.BaseLayoutProperties.html">Actor.Layout.BaseLayoutProperties</a></li>
											<li><a href="Actor.Layout.Canvas.html">Actor.Layout.Canvas</a></li>
											<li><a href="Actor.Layout.CanvasProperties.html">Actor.Layout.CanvasProperties</a></li>
											<li><a href="Actor.Layout.Modal.html">Actor.Layout.Modal</a></li>
											<li><a href="Actor.Layout.ModalProperties.html">Actor.Layout.ModalProperties</a></li>
											<li><a href="Actor.Layout.Stack.html">Actor.Layout.Stack</a></li>
											<li><a href="Actor.Layout.StackProperties.html">Actor.Layout.StackProperties</a></li>
											<li><a href="Actor.Layout.ViewBox.html">Actor.Layout.ViewBox</a></li>
											<li><a href="Actor.Layout.ViewBoxProperties.html">Actor.Layout.ViewBoxProperties</a></li>
											<li><a href="Actor.ReflectDetailsBase.html">Actor.ReflectDetailsBase</a></li>
											<li><a href="Actor.ReflectDetailsBaseProperties.html">Actor.ReflectDetailsBaseProperties</a></li>
											<li><a href="Actor.Request.BaseRequest.html">Actor.Request.BaseRequest</a></li>
											<li><a href="Actor.Request.BaseRequestList.html">Actor.Request.BaseRequestList</a></li>
											<li><a href="Actor.Request.BaseRequestListProperties.html">Actor.Request.BaseRequestListProperties</a></li>
											<li><a href="Actor.Request.BaseRequestProperties.html">Actor.Request.BaseRequestProperties</a></li>
											<li><a href="Actor.Unknown.html">Actor.Unknown</a></li>
											<li><a href="Behavior.DataContextual.html">Behavior.DataContextual</a></li>
											<li><a href="Behavior.Destroyable.html">Behavior.Destroyable</a></li>
											<li><a href="Behavior.Jokerable.html">Behavior.Jokerable</a></li>
											<li><a href="Behavior.Parenthood.html">Behavior.Parenthood</a></li>
											<li><a href="Behavior.SourceOfInternalBinding.html">Behavior.SourceOfInternalBinding</a></li>
											<li><a href="Behavior.Stage.html">Behavior.Stage</a></li>
											<li><a href="Behavior.WithAdditionals.html">Behavior.WithAdditionals</a></li>
											<li><a href="Behavior.WithEvents.html">Behavior.WithEvents</a></li>
											<li><a href="Behavior.WithProperties.html">Behavior.WithProperties</a></li>
											<li><a href="Binding.BasicBinding.html">Binding.BasicBinding</a></li>
											<li><a href="Binding.InternalBinding.html">Binding.InternalBinding</a></li>
											<li><a href="Binding.Setup.Actor.html">Binding.Setup.Actor</a></li>
											<li><a href="Binding.Setup.Relative.html">Binding.Setup.Relative</a></li>
											<li><a href="Binding.Setup.Stage.html">Binding.Setup.Stage</a></li>
											<li><a href="Event.BaseContext.html">Event.BaseContext</a></li>
											<li><a href="Event.BaseContextUtils.html">Event.BaseContextUtils</a></li>
											<li><a href="Event.PropertyChangedContext.html">Event.PropertyChangedContext</a></li>
											<li><a href="Event.RequestDataContext.html">Event.RequestDataContext</a></li>
											<li><a href="HW.Actor.AlarmFilter.html">HW.Actor.AlarmFilter</a></li>
											<li><a href="HW.Actor.FluxFilter.html">HW.Actor.FluxFilter</a></li>
											<li><a href="HW.Actor.InfraFilter.html">HW.Actor.InfraFilter</a></li>
											<li><a href="HW.Actor.InfraFilterProperties.html">HW.Actor.InfraFilterProperties</a></li>
											<li><a href="HW.Actor.ReflectClassFilter.html">HW.Actor.ReflectClassFilter</a></li>
											<li><a href="HW.Actor.ScopeFilter.html">HW.Actor.ScopeFilter</a></li>
											<li><a href="HW.Actor.SmartLocalUnitFilter.html">HW.Actor.SmartLocalUnitFilter</a></li>
											<li><a href="HW.Actor.WumFilter.html">HW.Actor.WumFilter</a></li>
											<li><a href="HW.Synapps.BaseHighwayStore.html">HW.Synapps.BaseHighwayStore</a></li>
											<li><a href="HW.Synapps.BusinessAccount.html">HW.Synapps.BusinessAccount</a></li>
											<li><a href="HW.Synapps.HighwayHost.html">HW.Synapps.HighwayHost</a></li>
											<li><a href="HW.Synapps.HighwaySession.html">HW.Synapps.HighwaySession</a></li>
											<li><a href="HW.Synapps.HighwayStore.html">HW.Synapps.HighwayStore</a></li>
											<li><a href="HW.Synapps.HighwaySynapp.html">HW.Synapps.HighwaySynapp</a></li>
											<li><a href="REDY.Accessory.WosRelativeVariableAccessory.html">REDY.Accessory.WosRelativeVariableAccessory</a></li>
											<li><a href="REDY.Actor.CollectionFilter.html">REDY.Actor.CollectionFilter</a></li>
											<li><a href="REDY.Actor.DeviceFilter.html">REDY.Actor.DeviceFilter</a></li>
											<li><a href="REDY.Actor.GroupFilter.html">REDY.Actor.GroupFilter</a></li>
											<li><a href="REDY.Actor.SiteFilter.html">REDY.Actor.SiteFilter</a></li>
											<li><a href="REDY.Actor.Synoptic.html">REDY.Actor.Synoptic</a></li>
											<li><a href="REDY.Actor.SynopticProperties.html">REDY.Actor.SynopticProperties</a></li>
											<li><a href="REDY.Actor.WosRelativeVariableSource.html">REDY.Actor.WosRelativeVariableSource</a></li>
											<li><a href="REDY.Actor.WosRelativeVariableSourceProperties.html">REDY.Actor.WosRelativeVariableSourceProperties</a></li>
											<li><a href="REDY.Actor.WosVariableSource.html">REDY.Actor.WosVariableSource</a></li>
											<li><a href="REDY.Actor.WosVariableSourceProperties.html">REDY.Actor.WosVariableSourceProperties</a></li>
											<li><a href="REDY.Actor.ZoneFilter.html">REDY.Actor.ZoneFilter</a></li>
											<li><a href="REDY.Behavior.WosRelativeVariableAble.html">REDY.Behavior.WosRelativeVariableAble</a></li>
											<li><a href="REDY.Synapps.RedyHost.html">REDY.Synapps.RedyHost</a></li>
											<li><a href="REDY.Synapps.RedySession.html">REDY.Synapps.RedySession</a></li>
											<li><a href="REDY.Synapps.RedyStore.html">REDY.Synapps.RedyStore</a></li>
											<li><a href="Synapps.Ajax.html">Synapps.Ajax</a></li>
											<li><a href="Synapps.BaseDataStore.html">Synapps.BaseDataStore</a></li>
											<li><a href="Synapps.BaseHost.html">Synapps.BaseHost</a></li>
											<li><a href="Synapps.BaseSession.html">Synapps.BaseSession</a></li>
											<li><a href="Synapps.BaseSetupDataStore.html">Synapps.BaseSetupDataStore</a></li>
											<li><a href="Synapps.BaseUser.html">Synapps.BaseUser</a></li>
											<li><a href="Synapps.Model.html">Synapps.Model</a></li>
											<li><a href="Synapps.PrototypedBase.html">Synapps.PrototypedBase</a></li>
											<li><a href="Synapps.Reflect.ReflectAgenda.html">Synapps.Reflect.ReflectAgenda</a></li>
											<li><a href="Synapps.Reflect.ReflectAnalog.html">Synapps.Reflect.ReflectAnalog</a></li>
											<li><a href="Synapps.Reflect.ReflectAnalogCommand.html">Synapps.Reflect.ReflectAnalogCommand</a></li>
											<li><a href="Synapps.Reflect.ReflectBase.html">Synapps.Reflect.ReflectBase</a></li>
											<li><a href="Synapps.Reflect.ReflectBoiler.html">Synapps.Reflect.ReflectBoiler</a></li>
											<li><a href="Synapps.Reflect.ReflectBoilerCommand.html">Synapps.Reflect.ReflectBoilerCommand</a></li>
											<li><a href="Synapps.Reflect.ReflectBurner.html">Synapps.Reflect.ReflectBurner</a></li>
											<li><a href="Synapps.Reflect.ReflectDigital.html">Synapps.Reflect.ReflectDigital</a></li>
											<li><a href="Synapps.Reflect.ReflectDigitalCommand.html">Synapps.Reflect.ReflectDigitalCommand</a></li>
											<li><a href="Synapps.Reflect.ReflectState.html">Synapps.Reflect.ReflectState</a></li>
											<li><a href="Synapps.Reflect.ReflectText.html">Synapps.Reflect.ReflectText</a></li>
											<li><a href="Synapps.Reflect.ReflectTextCommand.html">Synapps.Reflect.ReflectTextCommand</a></li>
											<li><a href="Synapps.Reflect.ReflectValve.html">Synapps.Reflect.ReflectValve</a></li>
											<li><a href="Synapps.Reflect.ReflectValveCommand.html">Synapps.Reflect.ReflectValveCommand</a></li>
											<li><a href="Synapps.Scene.html">Synapps.Scene</a></li>
											<li><a href="Synapps.Serializer.html">Synapps.Serializer</a></li>
											<li><a href="Synapps.Synapp.html">Synapps.Synapp</a></li>
											<li><a href="Synapps.SynappSetup.html">Synapps.SynappSetup</a></li>
											<li><a href="Synapps.UserAgent.html">Synapps.UserAgent</a></li>
									</ul>
								</li>
								<li class="dropdown">
									<a href="list_namespace.html" class="dropdown-toggle" data-toggle="dropdown">Espaces de nom<b class="caret"></b></a>
									<ul class="dropdown-menu">
											<li><a href="Accessory.html">Accessory</a></li>
											<li><a href="Actor.html">Actor</a></li>
											<li><a href="Actor.Charting.html">Actor.Charting</a></li>
											<li><a href="Actor.Display.html">Actor.Display</a></li>
											<li><a href="Actor.Input.html">Actor.Input</a></li>
											<li><a href="Actor.Layout.html">Actor.Layout</a></li>
											<li><a href="Actor.Request.html">Actor.Request</a></li>
											<li><a href="Behavior.html">Behavior</a></li>
											<li><a href="Binding.html">Binding</a></li>
											<li><a href="Event.html">Event</a></li>
											<li><a href="HW.Actor.html">HW.Actor</a></li>
											<li><a href="HW.Actor.html">HW.Actor</a></li>
											<li><a href="HW.Synapps.html">HW.Synapps</a></li>
											<li><a href="JSON.html">JSON</a></li>
											<li><a href="REDY.html">REDY</a></li>
											<li><a href="REDY.Actor.html">REDY.Actor</a></li>
											<li><a href="REDY.Behavior.html">REDY.Behavior</a></li>
											<li><a href="REDY.Synapps.html">REDY.Synapps</a></li>
											<li><a href="Synapps.html">Synapps</a></li>
											<li><a href="Synapps.Reflect.html">Synapps.Reflect</a></li>
									</ul>
								</li>
				</ul>
					<!-- start:lunr-search-navbar.hbs -->
					<form class="navbar-form navbar-right" role="search">
						<div class="input-group">
							<input type="text" class="form-control" placeholder="Search" id="lunr-search-input">
							<div class="input-group-btn">
								<button class="btn btn-default" id="lunr-search-submit">
									<i class="glyphicon glyphicon-search"></i>
								</button>
							</div>
						</div>
					</form>
					<!-- start:lunr-search-navbar.hbs -->		</div>
		</div>
	</header>
	<!-- end:navbar.hbs -->		<div class="page-header">
			<div class="container">
				<span class="kind">source</span>
				<h1><span class="name">synapps-ui/addon/components/actors/base-actor.js</span></h1>
			</div>
		</div>
	<div class="container content">
		<div class="row">
			<div class="col-md-12 main-content">
		<section class="source-section">
			<article></article>
			<pre class="prettyprint source language-javascript line-numbers"><code class="language-javascript">/* eslint-disable ember/no-empty-glimmer-component-classes */
/* eslint-disable ember/no-global-jquery */
/* eslint-disable ember/no-jquery */
/* global $*/
import { assert, runInDebug } from '@ember/debug';
import { action, computed, defineProperty, get, set } from '@ember/object';
import { alias, readOnly } from '@ember/object/computed';
import { run } from '@ember/runloop';
import { inject as service } from '@ember/service';
import { isEmpty, isNone } from '@ember/utils';
import Component from '@glimmer/component';
import { tracked } from '@glimmer/tracking';
import logger from 'logger';
import Accessory from 'synapps-ui/accessories/base';
import DataContextual from 'synapps-ui/behaviors/data-contextual';
import SourceOfInternalBinding from 'synapps-ui/behaviors/source-of-internal-binding';
import V1EventScript from 'synapps-ui/behaviors/v1-event-script';
import WithAdditionals from 'synapps-ui/behaviors/with-additionals';
import WithProperties from 'synapps-ui/behaviors/with-properties';
import BasicBinding from 'synapps-ui/bindings/basic';
import InternalBinding from 'synapps-ui/bindings/internal';
import basePrototypeSetup from 'synapps-ui/components/actors/base-actor-prototype-setup';
import actorDefinitions from 'synapps-ui/components/actors/definitions';
import Styling from 'synapps-ui/components/actors/styling';
import WithEvents from 'synapps-ui/components/behaviors/with-events';
import Flexibility from 'synapps-ui/components/flexibility';
import BindingsRegister from 'synapps-ui/registers/bindings';
import hasOwnProperty from 'synapps-ui/tools/has-own-property';

const isAuto = s => s === 'auto' || isNone(s);

function getValue(computedStyle, propName) {
  const size = parseFloat(computedStyle[propName]);
  return isNaN(size) ? 0 : size;
}

var resizeObserver = new ResizeObserver(function(entries) {
  requestAnimationFrame(() => {
    if (!Array.isArray(entries) || !entries.length) {
      return;
    }

    run(() => {
      for (const entry of entries) {
        if (!entry.target._synappActor) return;
        entry.target._synappActor._recomputeLayout();
      }
    });
  });
});

const Events = {
  onInit: 'onInit',
  onPostInit: 'onPostInit',
  onCssStyling: 'onCssStyling',
  onRender: 'onRender',
  onComputeLayout: 'onComputeLayout',
  onDestroy: 'onDestroy',
}

const DomEventHandlers = {
  onFocusIn: 'focusin',
  onFocusOut: 'focusout',
  onKeyUp: 'keyup',
  onKeyDown: 'keydown',
  onClick: 'click',
  onDoubleClick: 'dblclick',
  onMouseOver: 'mouseover',
  onMouseOut: 'mouseout',
  onMouseEnter: 'mouseenter',
  onMouseLeave: 'mouseleave',
  onMouseMove: 'mousemove',
  onMouseUp: 'mouseup',
  onMouseDown: 'mousedown',
  onContextMenu: 'contextmenu',
  onTouchEnd: 'touchend',
  onTouchStart: 'touchstart',
  onTouchMove: 'touchmove',
};

runInDebug(() => {
  window.ActorCount = 0;
})

@WithEvents
@WithAdditionals
@WithProperties
@DataContextual()
@SourceOfInternalBinding
@V1EventScript
class BaseActorComponent extends Component {}

/**
 * @namespace Actor
 */

/**
 * Acteur de base.
 * @private
 * @memberof Actor
 * @hideconstructor
 * @extends Behavior.WithEvents
 * @extends Behavior.WithAdditionals
 * @extends Behavior.WithProperties
 * @extends Behavior.DataContextual
 * @extends Behavior.SourceOfInternalBinding
 * @see Behavior.WithEvents
 * @see Behavior.WithAdditionals
 * @see Behavior.WithProperties
 * @see Behavior.DataContextual
 * @see Behavior.SourceOfInternalBinding
 */
class BaseActor extends BaseActorComponent {

  static actorDefinitions = actorDefinitions;
  static componentName;
  static basePrototypeSetup = basePrototypeSetup;

  /**
   * Enregistre la définition de l'acteur dans le dictionnaire des acteurs.
   *
   * @function Actor.BaseActor.registerInDefinitions
   * @param {Object} definition
   * @param {string} definition.type - La clé unique du type de l'acteur (ex: "input/button");
   * @param {string} definition.componentName - Nom complet du composant EmberJS (ex: "synapps-ui/actors/input/button").
   * @param {string} definition.prototypeSetup - Object qui contient les définitions des propriétés de l'acteur.
   * @param {string} [definition.platform="native"] - Nom de la plateforme à laquelle l'acteur appartient.
   * @private
   * @ignore
   * @static
   */
  static registerInDefinitions({ type, componentName, prototypeSetup, platform = 'native' }) {
    assert('[BaseActor][registerInDefinitions] type is required.', type);
    assert('[BaseActor][registerInDefinitions] prototypeSetup is required.', prototypeSetup);
    assert('[BaseActor][registerInDefinitions] componentName is required.', componentName);
    this.type = type;
    this.platform = platform;
    this.componentName = componentName;
    this.styling = new Styling({ prototypeSetup, Actor: this });
    this.actorDefinitions.set(type, this);
    this.typeCssClass = type.replace(/\//g, '-');
  }


  /**
   * Vrai quand l'acteur est détruit.
   *
   * @member Actor.BaseActor#isDestroyed
   * @readonly
   * @type {Boolean}
   */

  /**
   * Vrai quand l'acteur est en train d'être détruit.
   *
   * @member
   * @name Actor.BaseActor#isDestroying
   * @readonly
   * @type {Boolean}
   */

  static classNames = ['synapps-ui', 'actor'];


  /**
   * Obtient les magasins de données de la synapp.
   * @member Actor.BaseActor#dataStores
   * @type {REDY.Synapps.DataStores|HW.Synapps.DataStores}
   * @readonly
   */
  @service('data-stores')
  dataStores;

  @service
  notify;

  _bindingsRegister = new BindingsRegister(this);

  _accessories = {};

  @tracked
  _key = null;

  _styleName = 'default';

  _actor = null;

  @tracked
  _parent = null;

  @tracked
  _rootScene = null;

  @tracked
  _scene = null;

  @tracked
  _stage = null;

  _isReady = false;

  _isPostInit = false;

  _reRenderWatchdog = 0;

  _isLeadActor = false;

  _isInitialized = false;

  _isFirstRender = true;

  _initialClassNames;

  _initialStyle;

  get bindingsRegister() {
    return this._bindingsRegister;
  }

  /**
   * Obtient la liste des accessoires.
   * &lt;br> Chaque accessoire est accessible par sa clé :
   * ```js
   * this.accessories.log.properties.onActorPropertyChanged = true;
   * ```
   * pour accéder à l'accessoire `log` préalablement créé et activer la journalisation au changement de propriété de l'acteur.
   *  &lt;br> La gestion des accessoires s'effectue avec les méthodes : {@link Actor.BaseActor#createAccessory} et {@link Actor.BaseActor#removeAccessory}
   * @attribute
   * @type {Object}
   * @readonly
   */
  get accessories() {
    return this._accessories;
  }

  /**
   * La clé unique de l'acteur.
   * &lt;br>Son unicité est valable dans le contexte de la scène ou du composite parent direct de l'acteur.
   * @attribute
   * @readonly
   * @type {string}
   */
  get key() {
    return this._key;
  }

  /**
   * Scene ou Composite parent directe de l'acteur.
   * @attribute
   * @readonly
   * @type {Stage}
   */
  get stage() {
    return this._stage;
  }

  /**
   * Obtient la scène racine.
   * &lt;br> *Ce n'est pas forcément la [scène parente directe]{@link Actor.BaseActor#stage} de l'acteur.*
   * @attribute
   * @readonly
   * @type {Synapps.Scene}
   */
  get rootScene() {
    return this._rootScene;
  }


  /**
   * Première scène parente de l'acteur.
   * &lt;br> *Ce n'est pas forcément la [scène parente directe]{@link Actor.BaseActor#stage} de l'acteur ni même la [scène racine]{@link Actor.BaseActor#rootScene}.*
   * @attribute
   * @readonly
   * @type {Synapps.Scene}
   */
  get scene() {
    return this._scene;
  }

  /**
   * Obtient la Synapp.
   * @attribute
   * @readonly
   * @type {Synapps.Synapp}
   */
  get synapp() {
    return this._rootScene.synapp;
  }

  /**
   * Le nom du style de l'acteur.
   * &lt;br>
   * Pour changer de style, il faut utiliser {@link Actor.BaseActor#changeStyleName}
   * @attribute
   * @readonly
   * @type {String}
   */
  get styleName() {
    return this._styleName;
  }

  /**
   * L'élément DOM de l'acteur.
   *
   * &lt;br> *Attention! L'élément n'est pas accessible dans tous les scripts.*
   * @todo décrire les évènements
   * @attribute
   * @readonly
   * @type {Element}
   */
  get actor() {
    return this._actor;
  }

  /**
   * Acteur parent.
   * &lt;br> *Peut être absent si l'acteur est le principal.*
   *
   * @attribute
   * @readonly
   * @type {Actor.BaseActor}
   */
  get parent() {
    return this._parent;
  }

  /**
   * Type de l'acteur.
   *
   * @attribute
   * @readonly
   * @type {string}
   */
  get type() {
    return this.constructor.type;
  }

  /**
  Est-ce un acteur principal ?

  @attribute
  @readonly
  @type {Boolean}
  */
  get isLeadActor() {
    return this._isLeadActor;
  }

  get styling() {
    return this.constructor.styling;
  }

  /**
  Chemin unique de l'acteur.

  @attribute
  @readonly
  @type {string}
  */
  get uniqPath() {
    return `${this.stage.uniqPath}/${this.key}`;
  }

  /**
   * Classe `CSS` unique de l'acteur.
   * &lt;br> Elle permet de sélectionner l'élément du DOM de l'acteur.
   * @attribute
   * @readonly
   * @type {string}
   */
  get uniqClass() {
    return this.uniqPath.replace(/~/, '').replace(/\//g, '_');
  }

  get isReady() {
    return this._isReady;
  }

  get isPostInit() {
    return this._isPostInit;
  }

  get isInitialized() {
    return this._isInitialized;
  }

  /**
   * Obtient la classe de base des accessoire pour en définir des nouveaux
   * @attribute
   * @readonly
   * @type {BaseAccessory}
   */
  get BaseAccessory() {
    return Accessory;
  }

  /**
   * Obtient l'acteur principal de la scène ou composite présentant l'acteur.
   *
   * @attribute
   * @readonly
   * @type {Actor.BaseActor}
   */
  get leadActor() {
    return this.isLeadActor || !this.parent ? this : this.parent.isLeadActor;
  }

  /**
   * ne pas utiliser
   * @hideconstructor
   * @private
   */
  constructor(owner, args) {
    super(owner, args);

    assert('[synapps-ui][actors][base] no setup in args.', args.setup);
    this._init(args);
    this._isInitialized = true;

    runInDebug(() => {
      window.ActorCount++;
      //logger.debug('constructor - ActorCount:', window.ActorCount, this.uniqPath);
    });
  }

  _init({ setup, stage, scene, rootScene, dataContext, isLeadActor = false, onDidAdd }) {
    try {
      assert('[synapps-ui][actors][base] no key in actor definition.', setup.key);
      assert('[synapps-ui][actors][base] no stage in args.' + setup.key, stage);

      this._key = setup.key;
      this._stage = stage;

      this._setup = setup;

      this._isLeadActor = isLeadActor;

      if (dataContext) {
        this.dataContext = dataContext;
      } else if (setup.dataContext) {
        this.dataContext = setup.dataContext;
      }

      if (rootScene) {
        this._rootScene = rootScene;
      }

      if (scene) {
        this._scene = scene;
      }

      if (onDidAdd) {
        onDidAdd(this);
      }

      if (!setup.styleName) {
        setup.styleName = 'default';
      }

      if (!setup.bindings) {
        setup.bindings = {};
      }

      if (!setup.accessories) {
        setup.accessories = {};
      }

      this._extractPropertiesFromSetup(setup);

      this._extractAdditionalsFromSetup(setup)

      this._extractEventsFromSetup(setup);

      this._extractAccessoriesFromSetup(setup);

      this.stage.actorsRegister.record({ record: this });

      this._onInit();

    } catch (e) {
      logger.error(e);
    }
  }

  _isAscendant(objectUi) {
    if (!this.parent) return false
    if (this.parent === objectUi) return true;
    return this.parent._isAscendant(objectUi);
  }

  _extractAccessoriesFromSetup(setup) {
    Object.entries(setup.accessories).forEach(([key, accessorySetup]) => {
      this.createAccessory(key, accessorySetup);
    });
  }

  _extractBindingsFromSetup(setup) {
    setup.bindings = setup.bindings || {};
    Object.entries(setup.bindings).forEach(([targetPath, bindingSetup]) => {
      if (bindingSetup.sourceType) {
        this.createInternalBinding(targetPath, bindingSetup);
      } else {
        this.createBasicBinding(targetPath, bindingSetup);
      }
    });
  }

  _extractPropertiesFromSetup(setup) {
    setup.properties = setup.properties || {};
    this._styleName = setup.styleName;
    set(this, '_properties', this.styling.createProperties(this.styleName, this));
    this.properties._cache = setup.properties;
    this._setupPropertiesEvents();
  }

  /**
   * Se produit lorsque l'acteur est initialisé.
   *
   * &lt;br> Attention, l'élément DOM n'est pas encore accessible, ni les autres acteurs présents.
   *
   * @event Actor.BaseActor#onInit
   * @param {Event.BaseContext} context Contexte de l'évènement.
   */

  /**
   * @ignore
   */
  _onInit() {
    this.runEvent(Events.onInit);
    this._invokeOnAccessories('onActorInit');
  }

  runEvent(eventName, args) {
    return super.runEvent(eventName, {
      stage: this.stage,
      scene: this.scene,
      rootScene: this.rootScene,
      synapp: this.stage.synapp,
      dataStores: this.dataStores,
      ...args
    });
  }

  _buildPropertyEventPath(propertyPath, eventType) {
    return `${propertyPath.replace(/\./g, '/')}/${eventType}`;
  }

  _runPropertyEvent(propertyPath, eventType, value, args) {
    const eventName = this._buildPropertyEventPath(propertyPath, eventType);
    return this._hasEvent(eventName) ? this.runEvent(eventName, args) : value;
  }

  _createPropertyEvent(propertyPath, eventType, eventScriptLines) {
    const eventName = this._buildPropertyEventPath(propertyPath, eventType);
    return this.createEvent(eventName, eventScriptLines);
  }

  _removePropertyEvent(propertyPath, eventType) {
    const eventName = this._buildPropertyEventPath(propertyPath, eventType);
    this.removeEvent(eventName);
  }

  createPropertyValueChangeEvent(propertyPath, eventScriptLines) {
    return this._createPropertyEvent(propertyPath, 'onValueChanged', eventScriptLines);
  }

  removePropertyValueChangedEvent(propertyPath) {
    this._removePropertyEvent(propertyPath, 'onValueChanged');
  }

  createBindingReadTransformEvent(propertyPath, eventScriptLines) {
    return this._createPropertyEvent(propertyPath, 'binding/onReadTransform', eventScriptLines);
  }

  removeBindingReadTransformEvent(propertyPath) {
    this._removePropertyEvent(propertyPath, 'binding/onReadTransform');
  }

  createBindingWriteTransformEvent(propertyPath, eventScriptLines) {
    return this._createPropertyEvent(propertyPath, 'binding/onWriteTransform', eventScriptLines);
  }

  removeBindingWriteTransformEvent(propertyPath) {
    this._removePropertyEvent(propertyPath, 'binding/onWriteTransform');
  }

  _reset() {
    this.properties.destroy();

    if (this.additionals) {
      this.additionals.destroy();
    }

    this.bindingsRegister.clear();

    if (this.accessories) {
      this._invokeOnAccessories('destroy');
      this._accessories = {};
    }
  }


  /**
   * Création d'une liaison basique.
   *
   * La source est prise dans le contexte de donnée.
   *
   * @example
   * Le `setup` est un objet
   * ```
   * actor.createBasicBinding('properties.width, { path: 'widthOfPanel' });
   * ```
   * La propriété largeur de l'acteur est maintenant liée au champ `widthOfPanel` de son contexte de donnée.
   *
   * @method
   * @param {string} targetValuePath Chemin de la cible de la liaison.
   * @param {JSON.BasicBinding} setup
   * @param {Boolean} [saveInSetup=true]
   * @returns {Binding.BasicBinding} la liaison créée.
   */
  createBasicBinding(targetValuePath, setup, saveInSetup = true) {
    const binding = new BasicBinding({
      target: this,
      targetValuePath,
      onReadTransform: this._onBindingReadTransform,
      onWriteTransform: this._onBindingWriteTransform,
      ...setup
    });
    if (saveInSetup) {
      this.args.setup.bindings[targetValuePath] = setup;
    }

    this.bindingsRegister.recordBinding(binding);
    binding.activate();
    return binding;
  }

  /**
   * Obtient une liaison de l'acteur par son chemin de la cible.
   * @method
   * @param {string} targetValuePath Chemin de la cible ex.: `properties.content`
   * @returns {Binding} la liaison demandée ou null si non trouvée.
   */
  getBinding(targetValuePath) {
    return this.bindingsRegister.findByKey(targetValuePath);
  }

  /**
   * Création d'une liaison interne.
   *
   * Le type de source permet à la liaison d'aller cherche la bonne source à placer dans le contexte de donnée de la liaison.
   *
   *
   * @example
   * Le `setup` est un objet différent en fonction du type de source.
   *
   * Pour un acteur :
   * ```
   * { sourceKey: '&lt;clé acteur>', path: 'le chemin de la valeur de la source' }
   * ```
   *
   * @method
   * @param {string} targetValuePath Chemin de la cible de la liaison.
   * @param {Object} setup
   * @param {Boolean} [saveInSetup=true]
   */
  createInternalBinding(targetValuePath, { sourceKey, sourcePath, sourceType, path = null, ...others }, saveInSetup = true) {
    assert('[Actor][Base][createInternalBinding] sourceType is required.', sourceType);
    let source = null;
    try {
      source = InternalBinding.resolveInternalSource({ sourceType, sourceKey, sourcePath, target: this, targetValuePath, path, ...others });
    } catch (e) {
      // rien à faire ici.
    }

    if (!source) {
      logger.error(`[Actor][Base][createInternalBinding] failed to resolve source [${sourceType}]${sourceKey?`[${sourceKey}]`:''}${sourcePath?`[${sourcePath}]`:''}.`);
      return null;
    }

    const basePath = InternalBinding.getBasePath({ sourceType, sourceKey, sourcePath, target: this, targetValuePath, ...others });
    let resolvedPath = path;
    if (!isEmpty(basePath)) {
      resolvedPath = `${basePath}${isEmpty(path) ? '' : `.${path}`}`;
    }

    const binding = new InternalBinding({
      target: this,
      targetValuePath,
      dataContext: source,
      path: isEmpty(resolvedPath) ? null : resolvedPath,
      onReadTransform: this._onBindingReadTransform,
      onWriteTransform: this._onBindingWriteTransform,
      ...others
    });
    if (saveInSetup) {
      this.args.setup.bindings[targetValuePath] = {
        sourceType,
        ...others
      };
      if (sourceKey) {
        this.args.setup.bindings[targetValuePath].sourceKey = sourceKey;
      }

      if (sourcePath) {
        this.args.setup.bindings[targetValuePath].sourcePath = sourcePath;
      }
    }

    this.bindingsRegister.recordBinding(binding);
    binding.activate();
    return binding;
  }

  /**
   * Suppression d'une liaison sur un chemin cible.
   *
   * @method removeBinding
   * @memberof Actor.BaseActor#
   * @param {string} targetValuePath Chemin vers la cible de la liaison
   */
  removeBinding(targetValuePath) {
    const binding = this.bindingsRegister.findByKey({ targetValuePath });
    binding.deactivate();
    this.bindingsRegister.unrecordBinding(binding);
    delete this.setup.bindings[targetValuePath];
    binding.destroy();
    delete this.args.setup.bindings[targetValuePath];
  }

  /**
   * @todo à documenter.
   * Création d'une instance d'accessoire.
   * @method createAccessory
   * @memberof Actor.BaseActor#
   * @param {*} key Clé unique.
   * @param {*} setup
   * @param {*} saveInSetup
   * @returns {Accessory} L'accessoire créé.
   */
  createAccessory(key, setup, saveInSetup = true) {
    assert('[BaseActor][createAccessory] key is required.', key);
    assert('[BaseActor][createAccessory] setup is required.', setup);
    assert('[BaseActor][createAccessory] setup.type is required.', setup.type);
    const type = setup.type;

    if (!Accessory.accessoryDefs.has(type)) return;

    const AccessoryClass = Accessory.accessoryDefs.get(type);

    if (hasOwnProperty(this.accessories, key)) return;
    const accessory = new AccessoryClass({ key, actor: this, setup });
    this.accessories[key] = accessory;
    this.setup.accessories = this.setup.accessories || {};
    if (saveInSetup) {
      this.setup.accessories[key] = setup;
    }

    return accessory;
  }

  /**
   * Suppression d'un accessoire
   * @param {string} key
   */
  removeAccessory(key) {
    if (!hasOwnProperty(this.accessories, key)) return;
    const accessory = this.accessories[key];
    delete this.setup.accessories[key];
    accessory.destroy();
    delete this.accessories[key];
  }

  /**
   * Changer le nom du style de l'acteur.
   * @todo Que se passe t il si le nom de style ne correspond à aucun défini ?
   * @method
   * @param {String} styleName Nom du style à appliquer.
   */
  changeStyleName(styleName) {
    if (styleName === this.styleName) return;
    this.actor.classList.remove(this.styleName);
    this.actor.classList.add(styleName);
    this.properties.destroy();

    this.args.setup.styleName = styleName;

    this._extractPropertiesFromSetup(this.args.setup);
    this._invalidateProperties();
  }

  _doStyling() {
    if (this.isDestroying || this.isDestroyed) return;

    if (!this.isReady) {
      // logger.debug(`_doStyling aborted on not ready actor [${this.key}]`);
      return;
    }

    const style = this._doComputeStyle({ properties: this.properties });

    if (!this._initialStyle) {
      const s = this.actor.attributes['style'];
      if (!s) {
        this._initialStyle = '';
      } else {
        this._initialStyle = s;
      }
    }

    this.actor.style = {};
    Object.assign(this.actor.style, this._initialStyle, style)

    if (hasOwnProperty(style, '--opacity')) {
      this.actor.style.setProperty('--opacity', style['--opacity']);
    }

    if (hasOwnProperty(style, '--rotate')) {
      this.actor.style.setProperty('--rotate', style['--rotate']);
    }

    if (hasOwnProperty(style, '--translate-x')) {
      this.actor.style.setProperty('--translate-x', style['--translate-x']);
    }

    if (hasOwnProperty(style, '--translate-y')) {
      this.actor.style.setProperty('--translate-y', style['--translate-y']);
    }

    if (hasOwnProperty(style, '--scaling')) {
      this.actor.style.setProperty('--scaling', style['--scaling']);
    }

    this._onStyling();

     /**
       * Se produit lorsque l'acteur applique son style CSS.
       *
       * @event Actor.BaseActor#onCssStyling
       * @param {Event.BaseContext} context Contexte de l'évènement.
       */
      this.runEvent(Events.onCssStyling);
      this._invokeOnAccessories('onActorCssStyling')
  }

  _onStyling() {
    //
  }

  _doRender(withComputeLayout = true) {
    if (this.isDestroying || this.isDestroyed) return;
    if (!this.isReady) {
      // logger.debug(`_doRender aborted on not ready actor [${this.key}]`);
      return;
    }

    if (this._reRenderWatchdog > 0) {
      this._isFirstRender = false;
    }

    this._onWillRender();
    this._doStyling();
    if (this._reRenderWatchdog > 50) {
      logger.warn('[SynappsUI][Actors][Base][_doRender] re-render watchdog exceeded with actor #' + this.uniqPath + '.');
      this._reRenderWatchdog = 0;
      return;
    }

    this._reRenderWatchdog++;
    if (withComputeLayout) {
      this._doComputeLayout(!this._isFirstRender);
    }

    this._onDidRender();
    this._reRenderWatchdog = 1;
  }

  _recomputeLayout() {

    if (this.isDestroyed || this.isDestroying) return;
    if (!this.isReady) return;
    // logger.debug('resize!', this.uniqPath);
    this._doComputeLayout();

    if (
      this.parent
      &amp;&amp; !this.parent.isDestroyed &amp;&amp; !this.parent.isDestroying
      // &amp;&amp; !entries.find(e => this.parent === e.target._synappActor)
    ) {
      this.parent._doComputeLayout();
    }

    if (this.isParent) {
      for (const childUi of this.childUis) {
        if (
          !childUi.isDestroyed &amp;&amp; !childUi.isDestroying
          // &amp;&amp; !entries.find(e => childUi === e.target._synappActor)
        ) {
          childUi._doComputeLayout();
        }
      }
    }
  }

  _doComputeLayout(withRunEvent = true) {

    if (this.isDestroyed || this.isDestroying) return;

    // Doit être Fait deux fois : une première fois en remontant,
    // une deuxième en descendant.

    if (this._isDoingComputeLayout) return;
    if (!this.actor) return;
    this._isDoingComputeLayout = true;

    if (
      this.properties.fontSize !== 'inherit'
      &amp;&amp; typeof this.properties.fontSize === 'string'
      &amp;&amp; this.properties.fontSize.includes('%')
    ) {
      this.actor.style.setProperty('font-size', `${$(this.parent.actor).height() * parseFloat(this.properties.fontSize)/100}px`);
    }

    if (withRunEvent) {
      /**
       * Se produit lorsque l'acteur calcul son gabarit.
       *
       * @event Actor.BaseActor#onComputeLayout
       * @param {Event.BaseContext} context Contexte de l'évènement.
       */
      this.runEvent(Events.onComputeLayout);
      this._invokeOnAccessories('onActorComputeLayout')
    }

    this._isDoingComputeLayout = false;

    this._sendAllSizesToPreviewer();
  }

  _sendSizeToPreviewer() {
    const element = this.actor;
    if (!element) return;
    if (!this.args.previewer) return;
    const elementComputedStyle = getComputedStyle(element);
    const parents = [];
    let parent = element.parentNode;
    while (parent &amp;&amp; parent instanceof Element) {
      parents.unshift(getComputedStyle(parent));
      parent = parent.parentNode;
    }

    const size = {
      height: element.offsetHeight - getValue(elementComputedStyle, 'paddingTop') - getValue(elementComputedStyle, 'paddingBottom'),
      width: element.offsetWidth - getValue(elementComputedStyle, 'paddingLeft') - getValue(elementComputedStyle, 'paddingRight'),
      paddingRight: getValue(elementComputedStyle, 'paddingRight'),
      paddingLeft: getValue(elementComputedStyle, 'paddingLeft'),
      paddingTop: getValue(elementComputedStyle, 'paddingTop'),
      paddingBottom: getValue(elementComputedStyle, 'paddingBottom'),
      marginRight: getValue(elementComputedStyle, 'marginRight'),
      marginLeft: getValue(elementComputedStyle, 'marginLeft'),
      marginTop: getValue(elementComputedStyle, 'marginTop'),
      marginBottom: getValue(elementComputedStyle, 'marginBottom'),
      borderWidth: elementComputedStyle.borderWidth,
      transform: elementComputedStyle.transform,
      parentTransforms: parents.map(p => p.transform).filter(t => t !== 'none'),
      display: elementComputedStyle.display,
    };

    const rect = element.getBoundingClientRect();

    this.args.previewer.postMessage('from-runtime:size-change', {
      key: this.key,
      size,
      rect,
    });
  }

  _sendAllSizesToPreviewer() {
    if (!this.args.previewer) return;
    if (this.args.previewer.isDestroyed || this.args.previewer.isDestroying) return;
    this.args.previewer.sendAllSizesDebounced();
  }

  _willLayoutResize() {
    if (this.isDestroying || this.isDestroyed) return;
    if (!this.isReady) {
      // logger.debug(`_willLayoutResize aborted on not ready actor [${this.key}]`);
      return;
    }

    this._doRender(false);
  }

  _doAfterPropertyChanged({ prototyped, modifier, name, propertyPath, newValue, oldValue, ...args }) {
    if (this.isDestroyed || this.isDestroying) return;
    // logger.debug('_doAfterPropertyChanged', this.uniqPath, name, newValue, oldValue);
    // TODO: Ici, cela va déclencher potentiellement des changements sur d'autres propriétés à cause des liaisons. Il va falloir mettre en queue la modification en gardant la plus générale et une fois les invalidations traitées, réaliser cette modification pour finir par lancer les callbacks de chaque propriété impactée
    this._invalidate(prototyped, name);
    switch (modifier) {
      case 'css':
        this._doStyling();
        break;

      case 'render':
        this._doRender();
        break;

      case 'layout':
        if (propertyPath.startsWith('additionals.')) {
          this._willLayoutResize();
          this._recomputeLayout();
        } else {

          this._willLayoutResize();
          if (this.parent &amp;&amp; this.parent.type === 'layout/view-box') {
            // certaines modification n'entraîne pas de resize. Donc, on le fait à la main.
            if ([
                'verticalAlignment',
                'horizontalAlignment',
                'marginTop',
                'marginBottom',
                'marginRight',
                'marginLeft',
                'paddingTop',
                'paddingBottom',
                'paddingRight',
                'paddingLeft',
                'borderWidth',
              ].includes(name)) {
              this._recomputeLayout();
            }
          }
        }

        break;

      default:
        break;
    }

    this._onAfterPropertyChanged({ prototyped, modifier, name, newValue, oldValue, propertyPath, ...args });
    // TODO: il va falloir aussi contrôler un déclenchement en boucle de changements de propriétés mais seulement dans studio.

    this._sendAllSizesToPreviewer();
  }

  didChangeDataContext({ newValue, oldValue }) {
    this._runPropertyEvent('dataContext', 'onValueChanged', newValue, { newValue, oldValue, name: 'dataContext', propertyPath: 'dataContext' });
    this._invokeOnAccessories('onActorValueChanged', { newValue, oldValue, name: 'dataContext', propertyPath: 'dataContext' });
  }

  _doAfterAdditionalChanged(...args) {
    this._doAfterPropertyChanged(...args);
  }

  _onAfterPropertyChanged({ modifier, name, propertyPath, newValue, ...args }) {

    /**
     * Se produit lorsque n'importe quelle propriété ou additionnelle de l'acteur ou de ses accessoires ou additionnelle voit sa valeur changer.
     *
     * @event Actor.BaseActor#onPropertyChanged
     * @param {Event.PropertyChangedContext} context Le contexte de l'évènement.
     */

    this.runEvent('onPropertyChanged', { modifier, propertyPath, name, newValue, ...args });
    this._invokeOnAccessories('onActorPropertyChanged', { modifier, propertyPath, name, newValue, ...args });

    /**
     * Se produit lorsque la valeur de propriété `[propertyName]` change.
     *
     * &lt;br>Par exemple l'évènement `properties/width/onValueChanged` se produit lorsque la propriété {@link Actor.BaseActorProperties#width} change.
     * @event Actor.BaseActor#properties/[propertyName]/onValueChanged
     * @param {Event.PropertyChangedContext} context
     */

    /**
     * Se produit lorsque la valeur de l'additionnelle `[additionalName]` a changé.
     *
     * &lt;br>Par exemple l'évènement `additionals/myText/onValueChanged` se produit lorsque l'additionnelle `myText` a changé.
     * @event Actor.BaseActor#additionals/[additionalName]/onValueChanged
     * @param {Event.PropertyChangedContext} context
     */

    this._runPropertyEvent(propertyPath, 'onValueChanged', newValue, { modifier, newValue, name, propertyPath, ...args });
    this._invokeOnAccessories('onActorValueChanged', { modifier, newValue, name, propertyPath, ...args });

    if (propertyPath === 'properties.toolTip') {
      this._setupTitle();
    }
  }

  _invalidate(prototyped, name) {
    if (prototyped._isAdditionals) {
      this._invalidateAdditionals(name);
    } else {
      this._invalidateProperties(name);
    }
  }

  @action
  _onBindingReadTransform({ value, binding }) {

    /**
     * Se produit à la lecture de la source d'une liaison vers une propriété `propertyName`.
     * Il est possible de transformer la valeur lue pour écrire autre chose dans la cible.
     *
     * &lt;br>Par exemple l'évènement `properties/width/binding/onReadTransform` se produit lorsque la source de la liaison vers la propriété {@link Actor.BaseActorProperties#width} est lue.
     * @event Actor.BaseActor#properties/[propertyName]/binding/onReadTransform
     * @param {Event.OnBindingTransformContext} context Le contexte de l'évènement.
     * @return {any} la valeur lue par défaut.
     */

    /**
     * Se produit à la lecture de la source d'une liaison vers une additionnelle `additionalName`.
     * Il est possible de transformer la valeur lue pour écrire autre chose dans la cible.
     *
     * &lt;br>Par exemple l'évènement `additionals/myText/binding/onReadTransform` se produit lorsque la source de la liaison vers l'additionnelle `myText` est lue.
     * @event Actor.BaseActor#additionals/[additionalName]/binding/onReadTransform
     * @param {Event.OnBindingTransformContext} context Le contexte de l'évènement.
     * @return {any} la valeur lue par défaut.
     */
    let returnValue = this._runPropertyEvent(binding.targetValuePath, 'binding/onReadTransform', value, { value, binding, propertyPath: binding.targetValuePath });
    const args = this._composeOnAccessories('onActorBindingReadTransform', { value: returnValue, binding, propertyPath: binding.targetValuePath })
    return args.value;
  }

  @action
  _onBindingWriteTransform({ value, binding }) {

    /**
     * Se produit à l'écriture de la source d'une liaison vers une propriété `propertyName`.
     * Il est possible de transformer la valeur lue pour écrire autre chose dans la source.
     *
     * &lt;br>Par exemple l'évènement `properties/width/binding/onWriteTransform` se produit lorsque la propriété {@link Actor.BaseActorProperties#width} change et que sa valeur est écrite dans la source.
     * @event Actor.BaseActor#properties/[propertyName]/binding/onWriteTransform
     * @param {Event.OnBindingTransformContext} context
     * @return {any} la valeur lue par défaut.
     */

    /**
     * Se produit à écriture de la source d'une liaison vers une additionnelle `additionalName`.
     * Il est possible de transformer la valeur lue pour écrire autre chose dans la source.
     *
     * &lt;br>Par exemple l'évènement `additionals/myText/binding/onWriteTransform` se produit lorsque l'additionnelle `myText` change et que sa valeur est écrite dans la source.
     * @event Actor.BaseActor#additionals/[additionalName]/binding/onWriteTransform
     * @param {Event.OnBindingTransformContext} context
     * @return {any} la valeur lue par défaut.
     */
    const returnValue = this._runPropertyEvent(binding.targetValuePath, 'binding/onWriteTransform', value, { value, binding, propertyPath: binding.targetValuePath });
    const args = this._composeOnAccessories('onActorBindingWriteTransform', { value: returnValue, binding, propertyPath: binding.targetValuePath })
    return args.value;
  }

  _onWillRender() {
    this._setupClassList();
  }

  _doComputeStyle({ properties, style = {}, isAlreadyWrite = false }) {
    if (this.isDestroyed || this.isDestroying) return;

    const hasToSetupVisible = this.styling.hasToSetup('visible', properties, isAlreadyWrite);
    const visible = properties.visible;
    if (hasToSetupVisible &amp;&amp; !visible) {
      style.display = 'none';
      if (!isAlreadyWrite) {
        // pas besoin d'aller plus loin dans la définition du style.
        return style;
      }
    }

    this.styling.setupStyleKey(style, "width", properties, isAlreadyWrite, v => typeof v === 'number' ? `${v}px` : v);
    this.styling.setupStyleKey(style, "minWidth", properties, isAlreadyWrite);
    this.styling.setupStyleKey(style, "maxWidth", properties, isAlreadyWrite);
    this.styling.setupStyleKey(style, "height", properties, isAlreadyWrite, v => typeof v === 'number' ? `${v}px` : v);
    this.styling.setupStyleKey(style, "minHeight", properties, isAlreadyWrite);
    this.styling.setupStyleKey(style, "maxHeight", properties, isAlreadyWrite);
    this.styling.setupStyleKey(style, "fontStyle", properties, isAlreadyWrite);
    this.styling.setupStyleKey(style, "fontVariant", properties, isAlreadyWrite);
    this.styling.setupStyleKey(style, "textDecoration", properties, isAlreadyWrite);
    this.styling.setupStyleKey(style, "fontWeight", properties, isAlreadyWrite);
    this.styling.setupStyleKey(style, "fontFamily", properties, isAlreadyWrite);
    this.styling.setupStyleKey(style, "fontSize", properties, isAlreadyWrite,
      v => {
        if (typeof v === 'string' &amp;&amp; v.includes('%')) {
          return isAlreadyWrite || !this.parent || !this.parent.actor ? ''
            : `${$(this.parent.actor).height() * parseFloat(v)/100}px`;
        }

        return v;
      });
    this.styling.setupStyleKey(style, "lineHeight", properties, isAlreadyWrite);
    this.styling.setupStyleKey(style, "borderWidth", properties, isAlreadyWrite);
    this.styling.setupStyleKey(style, "borderStyle", properties, isAlreadyWrite);
    this.styling.setupStyleKey(style, "borderColor", properties, isAlreadyWrite);
    this.styling.setupStyleKey(style, "borderRadius", properties, isAlreadyWrite);
    this.styling.setupStyleKey(style, "color", properties, isAlreadyWrite);
    this.styling.setupStyleKey(style, "backgroundColor", properties, isAlreadyWrite);
    this.styling.setupStyleKey(style, "backgroundImage", properties, isAlreadyWrite, v => {
      // le plus souvent
      if (v === 'none') {
        return v;
      }

      if (
        v
        &amp;&amp; (
          v.startsWith('data:')
          || v.startsWith('http:')
          || v.startsWith('https:')
          || v.startsWith('file:')
          || v.startsWith('/current-project/')
        )
      ) {
        return `url(${v})`;
      }

      return v;
    });
    this.styling.setupStyleKey(style, "backgroundPosition", properties, isAlreadyWrite);
    this.styling.setupStyleKey(style, "backgroundSize", properties, isAlreadyWrite);
    this.styling.setupStyleKey(style, "backgroundAttachment", properties, isAlreadyWrite);
    this.styling.setupStyleKey(style, "backgroundRepeat", properties, isAlreadyWrite);
    this.styling.setupStyleKey(style, "boxShadow", properties, isAlreadyWrite);
    this.styling.setupStyleKey(style, "zIndex", properties, isAlreadyWrite);
    this.styling.setupStyleKey(style, "transition", properties, isAlreadyWrite);
    this.styling.setupStyleKey(style, "animation", properties, isAlreadyWrite, v => `400ms show-actor${isEmpty(v) ? '' : `, ${v}`}`);
    this.styling.setupStyleKey(style, "cursor", properties, isAlreadyWrite, v => {
      // le plus souvent
      if (v === 'inherit') {
        return v;
      }

      if (v
        &amp;&amp; (
          v.startsWith('data:')
          || v.startsWith('http:')
          || v.startsWith('https:')
          || v.startsWith('file:')
          || v.startsWith('/current-project/')
        )
      ) {
        return `url(${v}), auto`;
      }

      return v;
    });
    this.styling.setupStyleKey(style, "filter", properties, isAlreadyWrite);

    // if (!this.parent /*&amp;&amp; !isAlreadyWrite*/ ) {
    //   // on fait comme s'il était flexible.
    //   Flexibility._doComputeStyle({ objectUi: this, properties, isAlreadyWrite, style, orientation: 'vertical' });
    // }

    this._disposeInParent({ properties, style, isAlreadyWrite });

    this.styling.setupStyleKey(style, "paddingTop", properties, isAlreadyWrite);
    this.styling.setupStyleKey(style, "paddingBottom", properties, isAlreadyWrite);
    this.styling.setupStyleKey(style, "paddingLeft", properties, isAlreadyWrite);
    this.styling.setupStyleKey(style, "paddingRight", properties, isAlreadyWrite);
    this.styling.setupStyleKey(style, "textAlign", properties, isAlreadyWrite);

    if (this.styling.hasToSetup('opacity', properties, isAlreadyWrite)) {
      style['--opacity'] = properties.opacity / 100;
    }

    if (this.styling.hasToSetup('rotate', properties, isAlreadyWrite)) {
      let rotate = properties.rotate;
      if (!isEmpty(rotate)) {
        rotate = parseFloat(rotate);
        if (!isNaN(rotate) /*&amp;&amp; rotate !== 0*/ ) {
          style['--rotate'] = `${rotate}deg`
        }
      }
    }

    if (this.styling.hasToSetup('translateX', properties, isAlreadyWrite)) {
      let translateX = properties.translateX;
      if (!isEmpty(translateX)) {
        style['--translate-x'] = `${translateX}`
      }
    }

    if (this.styling.hasToSetup('translateY', properties, isAlreadyWrite)) {
      let translateY = properties.translateY;
      if (!isEmpty(translateY)) {
        style['--translate-y'] = `${translateY}`
      }
    }

    if (this.styling.hasToSetup('scaling', properties, isAlreadyWrite)) {
      let scaling = properties.scaling;
      if (!isEmpty(scaling)) {
        scaling = parseFloat(scaling);
        if (!isNaN(scaling) /*&amp;&amp; scaling !== 1*/ ) {
          style['--scaling'] = `${scaling}`
        }
      }
    }


    if (!isAlreadyWrite) {
      this._invokeOnAccessories('onActorDoComputeStyle', { style });
    }

    return style;
  }

  _setupMarginsStyle({ properties, style, isAlreadyWrite = false }) {
    this.styling.setupStyleKey(style, "marginTop", properties, isAlreadyWrite);
    this.styling.setupStyleKey(style, "marginBottom", properties, isAlreadyWrite);
    this.styling.setupStyleKey(style, "marginLeft", properties, isAlreadyWrite);
    this.styling.setupStyleKey(style, "marginRight", properties, isAlreadyWrite);
  }

  _disposeInParent({ properties, style, isAlreadyWrite = false }) {
    if (!this.parent) {
      // lead Actor de scène
      // on fait comme s'il était dans un Flexible.
      Flexibility.disposeChildStyle({ childUi: this, properties, style, isAlreadyWrite });
    } else {
      // in a layout. Dispose actor in it.
      this.parent._disposeChildStyle({ childUi: this, properties, style, isAlreadyWrite });
    }
  }

  _endingRender() {
    //
  }

  _onDidRender() {
    if (this.isDestroyed || this.isDestroying) return;
    if (this._isDoingRender) return;
    this._isDoingRender = true;
    const isFirstRender = this._isFirstRender;

    this._endingRender();

    /**
     * Se produit à chaque rendu de l'acteur dans l'interface.
     * Un champs `isFirstRender` est à `true` dans le contexte au premier rendu uniquement.
     *
     * @event Actor.BaseActor#onRender
     * @param {Event.BaseContext} context Le contexte de l'évènement. Avec en plus :
     * @param {Boolean} context.isFirstRender Vrai uniquement au premier rendu de l'acteur.
     */
    this.runEvent(Events.onRender, { isFirstRender });
    this._invokeOnAccessories('onActorRender', { isFirstRender });
    this._isDoingRender = false;
  }

  _getLayoutAncestor(objectUi) {

    // il faut remonter jusqu'au layout le plus haut qui arrête la propagation de changement de taille.
    // C'est à partir de lui que le redimensionnement s'opéreront.
    if (

      // il n'existe pas.
      !objectUi

      ||

      // pas de parent.
      !objectUi.parent

      ||

      // un parent mais c'est une toile.
      objectUi.parent.type === 'layout/canvas'

      ||

      // objectUi est de taille fixe.
      objectUi._isFixedSize()

      ||

      // objectUi est une boite à vue
      objectUi.type === 'layout/view-box'
    ) {
      return objectUi;
    }

    return this._getLayoutAncestor(objectUi.parent);
  }

  _isFixedSize() {
    const sizeInUnit = (size, unit) => size.includes(unit);
    const sizeInFixedUnit = size => sizeInUnit(size, 'px') || parseFloat(size) === size || sizeInUnit(size, 'cm');

    return (
      !isAuto(this.properties.width)
      &amp;&amp; !isAuto(this.properties.height)
      &amp;&amp; sizeInFixedUnit(this.properties.width)
      &amp;&amp; sizeInFixedUnit(this.properties.height)
    );
  }

  _setupTitle() {
    if (isEmpty(this.properties.toolTip)) {
      delete this.actor.title
    } else {
      this.actor.title = this.properties.toolTip;
    }
  }

  _doPostInit() {
    if (this.isDestroyed || this.isDestroying) return;

    this._extractBindingsFromSetup(this.args.setup);

    this._setupTitle();

    /**
     * Se produit juste avant le premier rendu de l'acteur mais après que tous les acteurs de la scène soient initialisés.
     *
     * &lt;br> On a accès à tous les éléments DOM, liaisons, ...
     * @event Actor.BaseActor#onPostInit
     * @param {Event.BaseContext} context
     */
    this.runEvent(Events.onPostInit);
    this._invokeOnAccessories('onActorPostInit');

    if (this.args.onDidPostInit) {
      this.args.onDidPostInit(this);
    }

    this._isPostInit = true;

  }

  _setupClassList() {
    if (!this._initialClassNames) {
      // récupèration de la liste des classes css mis en dur sur l'acteur.
      this._initialClassNames = [...this.actor.classList];
    }

    const classNames = [...this.constructor.classNames, ...(!isEmpty(this.properties.classNames) ? this.properties.classNames.split(' ') : [])];

    this.actor.classList.remove(...this.actor.classList);
    this.actor.classList.add(
      ...classNames,
      ...this._initialClassNames,
      this.constructor.typeCssClass,
      this.styleName,
      `actor-${this.key}`,
      this.uniqClass,
    );
  }

  @action
  _didElementInsert(actor) {
    this._actor = actor;

    actor._synappActor = this;
    resizeObserver.observe(actor);


    for (const key in this.events) {
      this._addEventListener(key);
    }

    this._doPostInit();
  }

  _addEventListener(eventName) {
    if (!this.actor) return;
    const domEventName = DomEventHandlers[eventName];
    const handler = this[`_${eventName}`];
    if (!handler) return;
    if (!domEventName) return;
    this.actor.removeEventListener(DomEventHandlers[eventName], handler);
    this.actor.addEventListener(DomEventHandlers[eventName], handler);
  }

  _removeEventListener(dom, eventName) {
    if (!dom) return;
    const domEventName = DomEventHandlers[eventName];
    const handler = this[`_${eventName}`];
    if (!handler) return;
    if (!domEventName) return;
    dom.removeEventListener(DomEventHandlers[eventName], handler);
  }

  createEvent(eventName, eventScriptLines) {
    this._addEventListener(eventName);
    return super.createEvent(eventName, eventScriptLines);
  }

  removeEvent(eventName) {
    this._removeEventListener(this.actor, eventName);
    super.removeEvent(eventName);
  }

  @action
  _didSetupChange({ objectUi, setup /*, ...others*/ }) {
    if (setup === this._setup) return;
    logger.debug('_didSetupChange', objectUi.key);
    this._reset();

    this._init({
      setup,
      stage: this.stage,
      scene: this.scene,
      rootScene: this.rootScene,
      dataContext: this.dataContext,
      isLeadActor: this.isLeadActor,
      onDidAdd: this.args.onDidAdd,
    });

    // this.actor.classList.add(this.styleName);
    this._doRender();
    this._invalidateProperties();
    this._invalidateAdditionals();
  }

  @action
  _modifierWillRemove(actor) {
    try {
      // sécurisation des processus de suppression d'acteur.
      this._onWillRemove(actor);
    } catch (error) {
      logger.debug('[ActorBase][_onWillRemove()]', error);
    }

    for (const key in this.events) {
      this._removeEventListener(actor, key);
    }

  }

  _invokeOnAccessories(methodName, args) {
    Object.values(this.accessories).forEach(accessory => {
      accessory[methodName](args);
    });
  }

  _composeOnAccessories(methodName, args) {
    let accArgs = args;
    Object.values(this.accessories).forEach(accessory => {
      accArgs = accessory[methodName](accArgs);
    });
    return accArgs;
  }

  _onWillRemove( /*actor*/ ) {

  }

  willDestroy() {
    if (this.isDestroyed) return;

    runInDebug(() => {
      window.ActorCount--;
      // logger.debug('willDestroy - ActorCount:', window.ActorCount, this.uniqPath);
    });

    this._invokeOnAccessories('onActorDestroy');

    /**
     * Se produit au moment de la destruction d'un acteur.
     *
     * @event Actor.BaseActor#onDestroy
     * @param {Event.BaseContext} context Le contexte de l'évènement
     */
    this.runEvent(Events.onDestroy);

    super.willDestroy();

    this._actor._synappActor = null;
    resizeObserver.unobserve(this._actor);
    this._actor = null;

    if (this.args.onDidRemove) {
      this.args.onDidRemove(this);
    }

    if (this.stage &amp;&amp; this.stage.actorsRegister) {
      this.stage.actorsRegister.unrecord({ record: this });
    }

    this.bindingsRegister.destroy();
    this._bindingsRegister = null;

    if (this.accessories) {
      this._invokeOnAccessories('destroy');
      this._accessories = null;
    }
  }

  @action
  _onFocusIn(focusEvent) {
    /**
     * Se produit lorsque l'acteur est sur le point d'obtenir le focus.
     *
     * @event Actor.BaseActor#onFocusIn
     * @param {Event.BaseContext} context Le contexte de l'évènement.
     * @param {FocusEvent} context.focusEvent L'évènement de focus.
     */
    const result = this.runEvent('onFocusIn', { focusEvent });
    this._invokeOnAccessories('onActorFocusIn', { focusEvent });
    return result;
  }

  @action
  _onFocusOut(focusEvent) {
    /**
     * Se produit lorsque l'acteur est sur le point de perdre le focus.
     *
     * @event Actor.BaseActor#onFocusOut
     * @param {Event.BaseContext} context Le contexte de l'évènement.
     * @param {FocusEvent} context.focusEvent L'évènement de clavier.
     */
    const result = this.runEvent('onFocusOut', { focusEvent });
    this._invokeOnAccessories('onActorFocusOut', { focusEvent });
    return result;
  }

  @action
  _onKeyDown(keyboardEvent) {
    /**
     * Se produit lorsque un touche de clavier est enfoncée dans l'acteur.
     *
     * @event Actor.BaseActor#onKeyDown
     * @param {Event.BaseContext} context Le contexte de l'évènement.
     * @param {KeyboardEvent} context.keyboardEvent L'évènement de clavier.
     */
    const result = this.runEvent('onKeyDown', { keyboardEvent });
    this._invokeOnAccessories('onActorKeyDown', { keyboardEvent });
    return result;
  }

  @action
  _onKeyUp(keyboardEvent) {
    /**
     * Se produit lorsque un touche de clavier est relâchée dans l'acteur.
     *
     * @event Actor.BaseActor#onKeyUp
     * @param {Event.BaseContext} context Le contexte de l'évènement.
     * @param {KeyboardEvent} context.keyboardEvent L'évènement de clavier.
     */
    const result = this.runEvent('onKeyUp', { keyboardEvent });
    this._invokeOnAccessories('onActorKeyUp', { keyboardEvent });
    return result;
  }

  @action
  _onClick(mouseEvent) {
    /**
     * Se produit au clic sur acteur.
     *
     * @event Actor.BaseActor#onClick
     * @param {Event.BaseContext} context Le contexte de l'évènement.
     * @param {MouseEvent} context.mouseEvent L'évènement de souris.
     */
    const result = this.runEvent('onClick', { mouseEvent });
    this._invokeOnAccessories('onActorClick', { mouseEvent });
    return result;
  }

  @action
  _onDoubleClick(mouseEvent) {
    /**
     * Se produit au double clic sur acteur.
     *
     * @event Actor.BaseActor#onDoubleClick
     * @param {Event.BaseContext} context Le contexte de l'évènement.
     * @param {MouseEvent} context.mouseEvent L'évènement de souris.
     */
    const result = this.runEvent('onDoubleClick', { mouseEvent });
    this._invokeOnAccessories('onActorDoubleClick', { mouseEvent });
    return result;
  }

  @action
  _onMouseEnter(mouseEvent) {
    /**
     * Se produit lorsque la souris entre dans acteur.
     *
     * @event Actor.BaseActor#onMouseEnter
     * @param {Event.BaseContext} context Le contexte de l'évènement.
     * @param {MouseEvent} context.mouseEvent L'évènement de souris.
     */
    const result = this.runEvent('onMouseEnter', { mouseEvent });
    this._invokeOnAccessories('onActorMouseEnter', { mouseEvent });
    return result;
  }

  @action
  _onMouseLeave(mouseEvent) {
    /**
     * Se produit lorsque la souris sort de l' acteur.
     *
     * @event Actor.BaseActor#onMouseLeave
     * @param {Event.BaseContext} context Le contexte de l'évènement.
     * @param {MouseEvent} context.mouseEvent L'évènement de souris.
     */
    const result = this.runEvent('onMouseLeave', { mouseEvent });
    this._invokeOnAccessories('onActorMouseLeave', { mouseEvent });
    return result;
  }

  @action
  _onMouseMove(mouseEvent) {
    /**
     * Se produit lorsque la souris se déplace au dessus de l' acteur.
     *
     * @event Actor.BaseActor#onMouseMove
     * @param {Event.BaseContext} context Le contexte de l'évènement.
     * @param {MouseEvent} context.mouseEvent L'évènement de souris.
     */
    const result = this.runEvent('onMouseMove', { mouseEvent });
    this._invokeOnAccessories('onActorMouseMove', { mouseEvent });
    return result;
  }

  @action
  _onMouseOver(mouseEvent) {
    /**
     * Se produit lorsque la souris survol l' acteur.
     *
     * @event Actor.BaseActor#onMouseOver
     * @param {Event.BaseContext} context Le contexte de l'évènement.
     * @param {MouseEvent} context.mouseEvent L'évènement de souris.
     */
    const result = this.runEvent('onMouseOver', { mouseEvent });
    this._invokeOnAccessories('onActorMouseOver', { mouseEvent });
    return result;
  }

  @action
  _onMouseOut(mouseEvent) {
    /**
     * Se produit lorsque la souris survol autre chose que l' acteur.
     *
     * @event Actor.BaseActor#onMouseOut
     * @param {Event.BaseContext} context Le contexte de l'évènement.
     * @param {MouseEvent} context.mouseEvent L'évènement de souris.
     */
    const result = this.runEvent('onMouseOut', { mouseEvent });
    this._invokeOnAccessories('onActorMouseOver', { mouseEvent });
    return result;
  }

  @action
  _onMouseUp(mouseEvent) {
    /**
     * Se produit lorsque un bouton de la souris est relâché au dessus de l'acteur .
     *
     * @event Actor.BaseActor#onMouseUp
     * @param {Event.BaseContext} context Le contexte de l'évènement.
     * @param {MouseEvent} context.mouseEvent L'évènement de souris.
     */
    const result = this.runEvent('onMouseUp', { mouseEvent });
    this._invokeOnAccessories('onActorMouseUp', { mouseEvent });
    return result;
  }

  @action
  _onMouseDown(mouseEvent) {
    /**
     * Se produit lorsque un bouton de la souris est appuyé au dessus de l'acteur .
     *
     * @event Actor.BaseActor#onMouseDown
     * @param {Event.BaseContext} context Le contexte de l'évènement.
     * @param {MouseEvent} context.mouseEvent L'évènement de souris.
     */
    const result = this.runEvent('onMouseDown', { mouseEvent });
    this._invokeOnAccessories('onActorMouseDown', { mouseEvent });
    return result;
  }

  @action
  _onContextMenu(mouseEvent) {
    /**
     * Se produit lorsque un bouton droit est cliqué pour afficher le menu contextuel.
     *
     * @event Actor.BaseActor#onContextMenu
     * @param {Event.BaseContext} context Le contexte de l'évènement.
     * @param {MouseEvent} context.mouseEvent L'évènement de souris.
     */
    const result = this.runEvent('onContextMenu', { mouseEvent });
    this._invokeOnAccessories('onActorContextMenu', { mouseEvent });
    return result;
  }

  @action
  _onTouchEnd(touchEvent) {
    /**
     * Se produit lorsque un ou plusieurs points de contact ont été relâchés sur l'acteur .
     *
     * @event Actor.BaseActor#onTouchEnd
     * @param {Event.BaseContext} context Le contexte de l'évènement.
     * @param {MouseEvent} context.mouseEvent L'évènement tactile.
     */
    const result = this.runEvent('onTouchEnd', { touchEvent });
    this._invokeOnAccessories('onActorTouchEnd', { touchEvent });
    return result;
  }

  @action
  _onTouchStart(touchEvent) {
    /**
     * Se produit lorsque un ou plusieurs points de contact ont été réalisés sur l'acteur .
     *
     * @event Actor.BaseActor#onTouchStart
     * @param {Event.BaseContext} context Le contexte de l'évènement.
     * @param {MouseEvent} context.mouseEvent L'évènement tactile.
     */
    const result = this.runEvent('onTouchStart', { touchEvent });
    this._invokeOnAccessories('onActorTouchStart', { touchEvent });
    return result;
  }

  @action
  _onTouchMove(touchEvent) {
    /**
     * Se produit lorsque un ou plusieurs points de contact ont été déplacés sur l'acteur .
     *
     * @event Actor.BaseActor#onTouchMove
     * @param {Event.BaseContext} context Le contexte de l'évènement.
     * @param {MouseEvent} context.mouseEvent L'évènement tactile.
     */
    const result = this.runEvent('onTouchMove', { touchEvent });
    this._invokeOnAccessories('onActorTouchMove', { touchEvent });
    return result;
  }

  // [MIGRATION V1]

  _getEventContextV1Class() {

    const BaseClass = super._getEventContextV1Class();


    const Class = class extends BaseClass {

      @readOnly('_objectUi.key')
      key;

      @readOnly('_objectUi.key')
      label;

      @readOnly('_objectUi.setup.oldType')
      type;

      @computed('_objectUi.actor')
      get dom() {
        return $(this._objectUi.actor);
      }

      isIt(key) {
        return this._objectUi.key === key;
      }

      @alias('datasourceVariable')
      datasource;

    }

    for (const key in this.properties.prototypeSetup) {
      if (hasOwnProperty(this.properties.prototypeSetup, key)) {
        defineProperty(Class.prototype, key, alias(`_objectUi.properties.${key}`));
      }
    }

    return Class;
  }
}

InternalBinding.registerInInternalSourceDefs({
  sourceType: 'actor',
  resolveSource: function resolveSource({ sourceKey, target }) {
    return target.stage.getActor(sourceKey);
  }
});
InternalBinding.registerInInternalSourceDefs({
  sourceType: 'relative',
  resolveSource: function resolveSource({ sourcePath, target }) {
    const path = !sourcePath || (sourcePath == 'self') ? '' : sourcePath;
    return isEmpty(path) ? target : get(target, path);
  }
});

export default BaseActor;

/**
 * Définition des setups JSON.
 * @namespace JSON
 */

/**
 * Contexte des changements de valeur de propriété.
 * @class Event.PropertyChangedContext
 * @extends Event.BaseContext
 * @see Event.BaseContext
 */

/**
 * Nouvelle valeur.
 * @member Event.PropertyChangedContext#newValue
 * @readonly
 * @type {any}
 */

/**
 * Ancienne valeur.
 * @member Event.PropertyChangedContext#oldValue
 * @readonly
 * @type {any}
 */

/**
 * Chemin de la propriété.
 * @member Event.PropertyChangedContext#propertyPath
 * @readonly
 * @type {string}
 */

/**
 * Nom de la propriété.
 * @member Event.PropertyChangedContext#name
 * @readonly
 * @type {string}
 */

/**
 * Type de modification entraînée par le changement.
 * @member Event.PropertyChangedContext#modifier
 * @readonly
 * @default 'other'
 * @type {'css'|'render'|'layout'|'other'}
 */
</code></pre>
		</section>
			</div>
		</div>
	</div>
	<footer>
			<div class="generated-by">Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.7</a> on 8th Apr 2022 using the <a href="https://github.com/steveush/foodoc">FooDoc template</a>.</div>
	</footer>
	<script src="js/jquery.min.js"></script>
	<script src="js/bootstrap.min.js"></script>
	<script src="js/clipboard.min.js"></script>
	<script src="js/prism.min.js"></script>
	<script src="js/template.min.js"></script>
		<!-- start:lunr-search-modal.hbs -->
		<div class="modal fade" id="lunr-search-modal">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title">Search results</h4>
					</div>
					<div class="modal-body" id="lunr-search-body">
					</div>
					<div class="modal-footer" id="lunr-search-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
					</div>
				</div><!-- /.modal-content -->
			</div><!-- /.modal-dialog -->
		</div>
		<!-- end:lunr-search-modal.hbs -->		<script src="js/lunr.min.js"></script>
	
</body>
</html>
<!-- end:source.tmpl.hbs -->